<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB Viewer Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="loading">Loading GLB model...</div>
    <div id="info">
        <p>GLB Viewer Test</p>
        <p id="status">Loading...</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        let scene, camera, renderer, controls;
        let loader;
        
        function init() {
            console.log('Initializing test scene...');
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
            
            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Loader
            loader = new THREE.GLTFLoader();
            
            // Load model
            loadModel();
            
            // Start animation
            animate();
        }
        
        function loadModel() {
            console.log('Attempting to load GLB model...');
            document.getElementById('status').textContent = 'Loading GLB...';
            
            loader.load(
                './asset/richards_art_gallery_-_audio_tour.glb',
                function(gltf) {
                    console.log('GLB loaded successfully!', gltf);
                    document.getElementById('status').textContent = 'GLB loaded successfully!';
                    document.getElementById('loading').style.display = 'none';
                    
                    const model = gltf.scene;
                    scene.add(model);
                    
                    // Auto-fit model
                    const box = new THREE.Box3().setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const fov = camera.fov * (Math.PI / 180);
                    let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                    cameraZ *= 1.5;
                    
                    camera.position.set(cameraZ, cameraZ * 0.5, cameraZ);
                    camera.lookAt(center);
                    controls.target.copy(center);
                    controls.update();
                },
                function(progress) {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    document.getElementById('status').textContent = `Loading... ${percent}%`;
                    console.log('Progress:', percent + '%');
                },
                function(error) {
                    console.error('Error loading GLB:', error);
                    document.getElementById('status').textContent = 'Error: ' + error.message;
                    document.getElementById('loading').textContent = 'Failed to load GLB model';
                    
                    // Add a simple cube as fallback
                    const geometry = new THREE.BoxGeometry(2, 2, 2);
                    const material = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
                    const cube = new THREE.Mesh(geometry, material);
                    scene.add(cube);
                    document.getElementById('loading').style.display = 'none';
                }
            );
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Start when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
